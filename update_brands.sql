-- Find empty brands based on UK version

SELECT products_uk.id, products_uk.title, products_uk.upc, products_uk.id_brands as brand_uk, products_ru.id_brands FROM products_uk 
left join products_ru on products_ru.id=products_uk.id
where products_ru.id_brands=0 and products_uk.id_brands>0;

-- Find empty brands based on RU version

SELECT products_ru.id, products_ru.title, products_ru.upc, products_ru.id_brands as brand_ru, products_uk.id_brands FROM products_ru 
left join products_uk on products_uk.id=products_ru.id
where products_uk.id_brands=0 and products_ru.id_brands>0;

-- Copy brand from UK version to RU
DROP PROCEDURE IF EXISTS update_brand;
DELIMITER $$
CREATE PROCEDURE update_brand()
BEGIN
   DECLARE cursor_List_isdone BOOLEAN DEFAULT FALSE;
   DECLARE cur_product_id INT;
   DECLARE cur_brand INT;

   DECLARE cursor_List CURSOR FOR 
    SELECT id, id_brands FROM products_uk 
    where id_brands>0
    ;

   DECLARE CONTINUE HANDLER FOR NOT FOUND SET cursor_List_isdone = TRUE;

   OPEN cursor_List;

   loop_List: LOOP
      FETCH cursor_List INTO cur_product_id, cur_brand;
      IF cursor_List_isdone THEN
        LEAVE loop_List;
      END IF;
      
      UPDATE `products_ru` 
      SET `id_brands`=cur_brand 
      WHERE `id`=cur_product_id;

   END LOOP loop_List;

   CLOSE cursor_List;
END

$$

DELIMITER ;

CALL update_brand();


-- Copy brand from RU version to UK
DROP PROCEDURE IF EXISTS update_brand;
DELIMITER $$
CREATE PROCEDURE update_brand()
BEGIN
   DECLARE cursor_List_isdone BOOLEAN DEFAULT FALSE;
   DECLARE cur_product_id INT;
   DECLARE cur_brand INT;

   DECLARE cursor_List CURSOR FOR 
    SELECT id, id_brands FROM products_ru 
    where id_brands>0
    ;

   DECLARE CONTINUE HANDLER FOR NOT FOUND SET cursor_List_isdone = TRUE;

   OPEN cursor_List;

   loop_List: LOOP
      FETCH cursor_List INTO cur_product_id, cur_brand;
      IF cursor_List_isdone THEN
        LEAVE loop_List;
      END IF;
      
      UPDATE `products_uk` 
      SET `id_brands`=cur_brand 
      WHERE `id`=cur_product_id AND id_brands=0;

   END LOOP loop_List;

   CLOSE cursor_List;
END

$$

DELIMITER ;

CALL update_brand();

-- Check

DELETE FROM teploradost.products_filter_fields 
where id_filter_fields=3818084353 
AND id_products IN(select p.id FROM products_uk as p 
left join products_filter_fields as pff ON p.id=pff.id_products 
where p.id IN(SELECT id_products FROM products_filter_fields where id_filter_fields=3818084353) 
AND id_filter_fields=3818084353 AND id_statuses=7);

-- delete
delete from products_filter_fields where id_filter_fields=3818084353 AND id_products IN(3249,3278,3364,7864,7904,10494,10527,10530,10532,10533,11270,11278,11279,11424,11425,11426,11427,11428,11429,11431,11432,11433,11435,11436,11437,11438,11439,11440,11441,11442,11443,11444,11445,11447,11450,11454,11455,11464,11465,11467,11468,11469,11470,11471,11472,11473,11815,11816,11817,11818,11821,11822,11823,11837,12741,13851,13879,13880,13881,13882,13883,13884,13885,13886,13887,14139,14142,14144,14153,14156,17433,17543,17545,17546,17547,17548,17550,17551,17552,17553,17554,17555,17557,17558,17560,17561,17562,17564,17565,17566,17567,17568,17569,17570,17571,17572,17573,17574,17575,17576,17577,17585,22249,23115,23466,23468,23471,23491,23492,23895,23896,23897,23898,23899,23900,23901,23902,23903,23904,23905,23906,23907,23908,23909,23910,23911,23912,23913,23914,23915,23916,23917,23918,23919,23920,23921,23922,23923,23924,23926,23927,23928,23929,23930,23931,23932,23933,23934,23935,23936,23937,23938,23939,23940,23941,23942,23943,23944,23945,23946,23947,23948,23949,23950,23951,23957,23958,23959,23960,23961,23962,23963,23964,23965,23966,23967,23968,23969,23970,23971,23972,23973,23974,23975,23976,23977,23978,23979,23980,23981,23982,23983,23984,23985,23986,23987,23988,24097,24099,24100,24101,24102,24105,24107,24108,24109,24113,24115,24140,24144,24145,24146,24155,24156,24157,24160,24161,24162,24163,24164,24169,24170,24171,24172,24173,24174,24182,24183,24187,24189,24191,24193,24194,24195,24196,24200,24202,24203,24204,24205,24206,24207,24208,24209,24211,24212,24213,24214,24215,24217,24218,24221,28562,28563,28564,30219,30426,36475,36854,50882,55117,55259,57489,58570,58613,59700,59722,59761,59900,60025,60026,60027,60028,61544,70461,70513,70536,72387,79486,79487,85333,89088,22312,55268,55266,55262,24132,24131,24130,17665,24166,24154,24153,24152,24151,24141,24137,24136,24135,24134,24133,24186,24185,24184,17695,24122,24120,24111,24094,17664,24148,24147,24143,24126,24125,24124,24123,24199,24198,24181,24180,24178,24177,24176,24175,24168,24165,55269,55267,55265,55264,14638,14639,14640,14641,14642,81252,58615,5924,20662,3333,3334,9946,9952,9954,9979,9980,9983,10005,10035,10040,24646,24647,24648,24649,24650,24651,24652,24653,24654,24655,49228,49246,59820,59821,59822,59823,59824,59825,59826,59827,59828,59829,59830,59831,59832,59833,59834,59835,59836,59837,59838,59839,59840,59841,59842,59843,13860,188,73610,58635,61047,61054,61055,23532,23533,79159,79160,79161,62471,62503,63076,63086,63092,63098,63241,63245,63325,63335,71007,71017,71050,71220,71221,71222,71224,71225,71241,71256,71263,71272,72292,72300,72303,72304,72326,72329,72331,72537,72546,72562,72566,72575,72577,72582,72584,72587,72588,72598,72606,72613,72644,72652,73460,73463,73470,73473,73509,73520,73523,73524,73525,73526,73527,73529,73530,73533,73534,73535,73539,73541,73542,73544,73556,73700,74038,74049,76843,76851,76856,87502,87509,73,14756,14758,14779,14780,14781,14782,14783,14824,14825,14826,14827,14828,14857,14858,14859,14860,14870,14871,14872,14873,14874,14885,14886,14887,14888,14889,14900,14901,14902,14903,16313,17441,17443,69904,69907,69908,69909,69910,69911,69912,69913,69914,69915,69916,69918,69920,69923,69925,69927,79086,79387,87774,87775,87776,17914,17915,17916,17917,17918,17920,17921,17922,17923,21974,21977,21978,21979,21981,21986,21987,21988,21989,21990,23324,24081,24082,24083,24087,24088,50933,59879,66409,66440,71126,71128,71130,71131,71132,71133,71135,71136,73238,73269,73270,73271,73274,73276,73281,73282,73283,73284,73285,73286,73287,73288,73289,73290,73291,73293,73294,73295,88842,88845,2937,2939,2944,2945,2946,5651,5652,5655,10590,13836,13841,13842,13909,13910,13915,14924,58553,58557,58575,76893,76894,76896,373,374,375,376,377,378,379,380,381,382,383,384,1551,1240,1433,1435,1436,1504,22932,50875,68134,68136,69810,74110,74128,75708,75732,75735,75739,75743,75745,75747,75749,75756,75758,75760,75762,75765,75768,75770,75771,75776,75783,75788,75789,75790,75792,76214,76256,76257,76260,76266,76274,76275,76277,76278,76280,82513,86446,1648,1651,1653,1655,1656,1842,1845,1846,1847,1848,22198,22199,22201,22203,22204,22206,22208,22210,22211,22212,22213,22214,22215,22217,22218,22219,22220,22221,22222,22223,22224,22225,22226,22227,59632,59637,65646,65760,61987,62023,70586,71608,72073,72730,72757,72762,72784,72812,72827,72829,72831,72927,73030,73253,73410,74054,1947,2892,2893,2896,2898,2899,2900,2901,2902,2903,2906,2907,2908,2910,2914,2915,2916,2917,2918,2919,2920,2921,2922,2923,2924,2927,2928,2929,2930,2931,2932,2933,11477,11478,11481,11672,12474,12476,12477,12478,12479,12480,12481,12482,12483,12484,12485,12486,12487,12488,12489,12490,12491,12492,12493,13733,13749,13750,13751,13752,13753,13754,13755,13756,13757,13758,13759,13760,13761,13762,13763,13764,13765,13766,13767,13768,13769,13771,14959,14960,14969,14970,14971,14972,14973,14974,14975,14976,14977,14978,14979,14980,14981,14982,14983,14984,14985,14986,14987,14988,14989,14990,14991,14992,14993,14994,14995,14996,14997,14998,14999,15000,15001,15002,15003,15004,15005,15006,15008,15009,15010,15011,15012,15048,15049,15050,15051,15052,15053,15054,15055,15056,15058,15059,15060,15061,15062,15063,15355,15458,15460,15461,15476,15477,15479,17678,17680,89569,86575,4497,4498,4499,4500,4501,4502,61568,77330,11713,17954,21947,21948,21949,21950,21952,21953,21954,21955,21956,21957,21958,21959,21962,21963,21964,24242,24244,24246,24248,24249,24250,24251,31163,42223,42228,42231,42233,42234,42236,42237,42238,42239,42240,47814,50752,55774,71367,77013,77027,77029,77034,77036,77393,78108,78109,78110,78121,78122,78123,78124,78139,79615,6106,6108,9817,9821,9832,9853,9898,9899,9900,9910,9911,11209,13538,13571,13572,13573,13574,15167,15168,15169,15170,15172,15173,15174,21293,29742,29744,58663,58666,58673,79118,81251,81253,81596,55780,55781,55782,55785,55786,55787,55788,55795,55797,55798,55807,55812,60486,69604,70922,70923,70924,74153,77889,85159,90395,23379,23380,23652,23653,23656,25167,25168,70892,13376,49423,3938,3939,3940,3941,3942,3944,6819,6823,17635,17645,17872,17873,75285,33369,57560,85613,85615,69026,5812,5937,5987,6001,6003,6216,6765,7180,8415,10597,10600,12926,12929,12933,12936,12959,13121,13351,13364,13367,13368,13812,13813,13814,13815,13816,13817,13818,13819,14539,14545,14546,14549,14550,14551,14565,15388,15389,15396,15397,15404,15405,15412,15420,15421,15428,15429,15432,15433,15436,15437,15440,15441,23367,23368,24089,24090,24091,24092,33372,33373,33388,49420,49421,54318,55414,57428,58307,59390,59844,62974,62975,64653,66430,66431,69336,69346,69670,70581,70887,73252,73808,73809,76784,76787,76789,76820,76822,77322,77323,77325,77738,77739,77748,78972,78974,85214,85219,85223,85225,85620,89551,93015,94542,94552,96073,17484,69972,70001,70009,70024,70051,70167,70169,70170,77681,78643,86075,86750,67532,67533,67534,67535,67536,67537,67538,67539,67540,67541,67542,67547,67548,73914,73918,73926,73937,73939,82354,73657,73881,73951,699,700,723,825,874,948,957,976,977,982,985,986,988,995,1000,1033,1070,1090,4917,4940,4995,5003,5037,5040,5044,5048,5726,7516,14054,17184,17190,17192,17206,17208,17210,17222,17224,17230,17234,17237,17241,17251,17259,17261,17307,17334,17346,17363,17369,17380,17386,17392,17401,17405,17407,17411,22301,22305,22330,22339,22912,22920,57721,57723,57790,57792,58013,58019,58311,58379,58592,59080,60421,66103,66745,66747,66749,66751,66753,66755,66757,66759,66761,66763,66765,66767,66769,66771,67168,69277,69279,69712,69721,69723,69724,69731,69738,69765,69771,69778,69783,69785,72892,73303,73304,73305,73308,74437,74447,74990,75556,75558,82584,84634,84645,84650,7491,7494,7495,5109,5089,5090,7488,7489,7476,5157,5158,5148,5150,5151,5133,7466,7468,7472,7459,7460,7463,7464,5236,5229,5232,63173,23175,16360,16380,16326,16356,16371,16376,16330,16340,16345,16355,16432,16412,6191,16429,16437,16422,16426,16486,16496,16461,16498,16503,16489,16499,16509,16459,16455,16460,16465,16480,78783,78785,78787,82378,82380,82382,82383,82384,82385,82386,17187,17207,17225,17231,17327,17360,17366,17377,17379,17387,17389,17393,17395,17406,17408,17410,17412);

delete from products_filter_fields where id_filter_fields=3818084353 AND id_products IN(7471,17260,17262,17335,17353,17383,61918);


